# Tool Call 显示设计方案

# Tool Call 显示设计方案

## 当前实现（方案 D - Tree View / GitHub Actions 风格）✅

**设计：**
- 工具调用显示为树形展开项
- 使用树形连接线（├─, └─）
- 状态图标清晰（✓ 成功 / ❌ 失败 / ⏳ 运行中）
- 显示执行时间（≥1s时显示）
- 默认展开，无需点击

**效果：**
```
ASSISTANT  17:41:37  I'll start by resolving the KIT_ROOT...
├─ ✓ 🔧 bash (0.2s)
└─ ✓ 🔧 read (0.1s)
```

**优点：**
- ✅ GitHub Actions 用户熟悉的界面
- ✅ 清晰的层级关系
- ✅ 状态一目了然（✓ ❌ ⏳）
- ✅ 执行时间直观显示
- ✅ 默认展开，无需交互

**实现细节：**
- 动态高度计算：每个工具调用行 22px
- 虚拟滚动优化：基于位置而非索引
- 工具分组：按 `toolCallId` 匹配 start + complete
- 颜色编码：绿色(成功) / 红色(失败) / 黄色(运行中)

---

## 方案 A - Inline Badge (已废弃)

**设计：**
- Tool call 数量以小徽章形式显示在时间戳旁边
- 点击徽章展开/收起工具列表
- 最紧凑，不增加垂直空间

**效果：**
```
ASSISTANT  17:41:37  ▶ 1  I'll start by resolving the KIT_ROOT...
```

点击后：
```
ASSISTANT  17:41:37  ▼ 1  I'll start by resolving the KIT_ROOT...
  └─ TOOL  17:41:38  bash
```

**优点：**
- ✅ 极致紧凑，不浪费空间
- ✅ 视觉干扰最小
- ✅ 点击展开才显示细节

**缺点：**
- ⚠️ 需要交互才能看到工具名称
- ⚠️ 不直观显示工具执行状态

---

## 方案 B - Tool Icons Inline

**设计：**
- 在消息同一行末尾显示工具图标/名称
- 紧凑的标签形式，只显示工具名称
- 悬停显示完整信息

**效果：**
```
ASSISTANT  17:41:37  I'll start by resolving...  🔧 bash  🔧 read
```

**优点：**
- ✅ 一目了然看到使用了哪些工具
- ✅ 不占用额外垂直空间
- ✅ 可以用颜色区分工具类型

**缺点：**
- ⚠️ 消息较长时会被挤到右侧
- ⚠️ 多个工具时可能换行

---

## 方案 C - Bottom Bar

**设计：**
- 在消息下方显示浅色工具栏
- 列出所有调用的工具
- 紧凑的单行展示

**效果：**
```
ASSISTANT  17:41:37
I'll start by resolving the KIT_ROOT and exploring...

🔧 bash • read (17:41:38)
```

**优点：**
- ✅ 清晰展示所有工具
- ✅ 时间戳一目了然
- ✅ 视觉层级分明

**缺点：**
- ⚠️ 每条有工具调用的消息都会增加一行
- ⚠️ 大量工具调用时占用较多空间

---

## 方案 D - Tree View (GitHub Actions 风格)

**设计：**
- 工具调用显示为树形展开项
- 点击展开查看详细参数和结果
- 支持嵌套（工具调用工具的情况）

**效果：**
```
ASSISTANT  17:41:37
└─ I'll start by resolving the KIT_ROOT...
   ├─ 🔧 bash (0.2s) ✓
   └─ 📄 read (0.1s) ✓
```

**优点：**
- ✅ GitHub 用户习惯的界面
- ✅ 清晰的层级关系
- ✅ 状态一目了然（✓ ❌ ⏳）

**缺点：**
- ⚠️ 占用垂直空间较多
- ⚠️ 实现复杂度高

---

## 方案 E - Minimal Pills

**设计：**
- 在消息右侧悬浮显示药丸状标签
- 只显示工具名称，无其他信息
- 点击展开查看详情

**效果：**
```
ASSISTANT  17:41:37  I'll start by resolving...               bash  read
```

**优点：**
- ✅ 最简洁的视觉效果
- ✅ 不打断消息阅读
- ✅ 悬浮在右侧，不占用内容空间

**缺点：**
- ⚠️ 宽屏优化，窄屏可能重叠
- ⚠️ 没有时间戳信息

---

## 推荐

**首选：方案 A（已实现）**
- 最紧凑，适合大量事件的 session
- 符合"只显示需要的信息"原则

**备选：方案 B（Tool Icons Inline）**
- 如果需要快速扫描工具使用情况
- 适合调试和性能分析场景

**长期：方案 D（Tree View）**
- 如果未来需要支持工具嵌套调用
- GitHub Actions 用户会很熟悉

---

## 交互细节建议

1. **颜色编码：**
   - 🟢 成功：绿色
   - 🔴 失败：红色
   - 🟡 运行中：黄色
   - 🔵 工具类型：蓝色（文件操作）、橙色（命令执行）

2. **性能指示：**
   - 显示执行时间（> 1s 的工具调用）
   - 突出显示慢速工具（> 5s）

3. **折叠逻辑：**
   - 默认收起所有工具调用
   - 错误的工具调用默认展开
   - 记住用户的展开状态（localStorage）

4. **工具详情：**
   - 参数（JSON 格式，可折叠）
   - 返回值（截断显示，点击查看完整）
   - 错误信息（红色高亮）

---

## 实现优先级

**P0 - 立即完成：**
- ✅ 方案 A 的基础实现（已完成）
- ⬜ 颜色编码（成功/失败）
- ⬜ 错误工具调用默认展开

**P1 - 本周内：**
- ⬜ 执行时间显示（> 1s）
- ⬜ 工具类型图标
- ⬜ 展开状态持久化

**P2 - 下个迭代：**
- ⬜ 方案 B 或 D 作为可选显示模式
- ⬜ 工具调用统计视图
- ⬜ 性能分析工具

---

如需修改设计方案，请告诉我具体想调整的部分！
